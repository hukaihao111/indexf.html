<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>王玲月点餐系统</title>
  <meta name="theme-color" content="#2563eb" />
  <style>
    :root {
      --primary: #2563eb;
      --primary-light: #3b82f6;
      --primary-dark: #1d4ed8;
      --secondary: #0ea5e9;
      --secondary-dark: #0284c7;
      --dark: #111827;
      --light: #f8f9fb;
      --gray: #f1f5f9;
      --text: #111;
      --text-light: #64748b;
      --shadow: 0 10px 20px rgba(0,0,0,0.1);
      --radius: 16px;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, PingFangSC, "Hiragino Sans GB", "Microsoft YaHei", Helvetica, Arial, sans-serif;
      background: var(--light);
      color: var(--text);
      text-align: center;
      line-height: 1.6;
      padding: 0;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background-image: 
        radial-gradient(at 10% 20%, rgba(37, 99, 235, 0.05) 0px, transparent 50%),
        radial-gradient(at 90% 80%, rgba(14, 165, 233, 0.05) 0px, transparent 50%);
    }
    
    .container {
      max-width: 800px;
      width: 100%;
      padding: 30px 20px;
      margin: 0 auto;
    }
    
    header {
      margin-bottom: 30px;
    }
    
    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 800;
    }
    
    .subtitle {
      color: var(--text-light);
      font-size: 1.1rem;
      margin-bottom: 30px;
    }
    
    .meal-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 18px 36px;
      font-size: 1.2rem;
      font-weight: 600;
      border: none;
      border-radius: var(--radius);
      cursor: pointer;
      color: #fff;
      background: var(--primary);
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      min-width: 140px;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 15px 25px rgba(37, 99, 235, 0.2);
    }
    
    .btn:active {
      transform: translateY(0);
    }
    
    .btn.breakfast { background: var(--primary); }
    .btn.lunch { background: var(--secondary); }
    .btn.dinner { background: var(--dark); }
    
    .result-container {
      background: white;
      border-radius: var(--radius);
      padding: 30px;
      margin: 30px 0;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    
    .result-box {
      font-size: 1.8rem;
      font-weight: 700;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
      transition: all 0.3s ease;
    }
    
    .result-label {
      display: block;
      font-size: 0.9rem;
      color: var(--text-light);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .actions {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 20px;
    }
    
    .btn.ghost {
      background: transparent;
      color: var(--text);
      border: 2px solid var(--gray);
      box-shadow: none;
    }
    
    .btn.ghost:hover {
      background: var(--gray);
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }
    
    .anim {
      animation: spin 1s ease-in-out;
    }
    
    @keyframes spin {
      0% { transform: translateY(0); }
      25% { transform: translateY(-10px); }
      50% { transform: translateY(0); }
      75% { transform: translateY(10px); }
      100% { transform: translateY(0); }
    }
    
    .edit-area {
      background: white;
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 30px;
      box-shadow: var(--shadow);
      text-align: left;
    }
    
    .edit-area h2 {
      margin-bottom: 20px;
      text-align: center;
      color: var(--primary);
    }
    
    .meal-list li {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .meal-list input {
      flex: 1;
      padding: 8px 12px;
      margin-right: 8px;
      border-radius: 8px;
      border: 1px solid var(--gray);
    }
    
    .meal-list button {
      padding: 6px 12px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      background: #f56565;
      color: white;
    }
    
    .history-panel {
      background: white;
      border-radius: var(--radius);
      padding: 30px;
      margin-top: 30px;
      box-shadow: var(--shadow);
      text-align: left;
      display: none;
    }
    
    .history-panel h2 {
      margin-bottom: 20px;
      text-align: center;
      color: var(--primary);
    }
    
    .history-list {
      list-style: none;
      padding: 0;
    }
    
    .history-item {
      padding: 10px;
      border-bottom: 1px solid var(--gray);
    }
    
    .tab-buttons {
      display: flex;
      justify-content: center;
      margin-bottom: 20px;
    }
    
    .tab-btn {
      padding: 12px 24px;
      background: var(--gray);
      border: none;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .tab-btn:first-child { border-radius: var(--radius) 0 0 var(--radius); }
    .tab-btn:last-child { border-radius: 0 var(--radius) var(--radius) 0; }
    .tab-btn.active { background: var(--primary); color: white; }
    
    footer { margin-top: 40px; color: var(--text-light); font-size: 0.9rem; }
    
    @media (max-width: 600px) {
      h1 { font-size: 2rem; }
      .btn { padding: 16px 24px; font-size: 1rem; min-width: 120px; }
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <h1>王玲月点餐系统</h1>
    <p class="subtitle">解决你的每日饮食选择困难症</p>
  </header>
  
  <div class="meal-buttons">
    <button class="btn breakfast" data-type="breakfast">早餐</button>
    <button class="btn lunch" data-type="lunch">午餐</button>
    <button class="btn dinner" data-type="dinner">晚餐</button>
  </div>
  
  <div class="result-container">
    <span class="result-label">今日推荐</span>
    <div class="result-box" id="result">请选择一餐开始</div>
  </div>
  
  <div class="actions">
    <button id="copy" class="btn ghost">复制内容</button>
    <button id="reroll" class="btn">再选一次</button>
    <button id="historyBtn" class="btn ghost">历史记录</button>
    <button id="editBtn" class="btn ghost">修改菜品</button>
  </div>
  
  <div class="tab-buttons">
    <button class="tab-btn active" data-tab="edit">编辑菜品</button>
    <button class="tab-btn" data-tab="history">查看历史</button>
  </div>
  
  <div id="editPanel" class="edit-area"></div>
  <div id="historyPanel" class="history-panel">
    <h2>最近选择</h2>
    <ul class="history-list" id="historyList"></ul>
    <div class="actions">
      <button id="clearHistory" class="btn ghost">清空记录</button>
    </div>
  </div>
</div>

<footer>
  <p>© 2025 王玲月点餐系统 - 让饮食选择变得更简单</p>
</footer>

<script>
const DEFAULT_DATA = {
  breakfast:["红枣燕麦粥","全麦面包+牛奶","鸡蛋羹+苹果"],
  lunch:["清蒸鲈鱼+西兰花","番茄鸡蛋汤+鸡肉","土豆炖牛肉+米饭"],
  dinner:["清蒸鲈鱼+西兰花","胡萝卜炖排骨+小米粥","番茄牛肉意面"]
};
let DATA={...DEFAULT_DATA};
let lastType=null,lastResult="";
let history=[];
let rerollCounts={breakfast:3,lunch:3,dinner:3};

const resultBox=document.getElementById('result');
const editPanel=document.getElementById('editPanel');
const historyPanel=document.getElementById('historyPanel');

function loadSavedData(){
  const savedData=localStorage.getItem('mealData');
  if(savedData) DATA=JSON.parse(savedData);
  const savedHistory=localStorage.getItem('mealHistory');
  if(savedHistory) history=JSON.parse(savedHistory);
}

function saveDataToStorage(){
  localStorage.setItem('mealData',JSON.stringify(DATA));
  localStorage.setItem('mealHistory',JSON.stringify(history));
}

function randomPick(type){
  const arr=DATA[type];
  if(!arr||arr.length===0) return;
  lastType=type;
  if(rerollCounts[type]>0){
    rerollCounts[type]--;
    document.getElementById('reroll').textContent=`再选一次(${rerollCounts[type]})`;
  } else {
    alert('今日机会已用完');
    return;
  }
  animatePick(type,arr);
}

function animatePick(type,arr){
  resultBox.classList.add('anim');
  let counter=0;
  const interval=setInterval(()=>{
    const tempChoice=arr[Math.floor(Math.random()*arr.length)];
    resultBox.textContent=tempChoice;
    counter++;
    if(counter>15){
      clearInterval(interval);
      lastResult=tempChoice;
      resultBox.classList.remove('anim');
      resultBox.textContent=tempChoice;
      addToHistory(type,tempChoice);
    }
  },100);
}

function addToHistory(type,meal){
  const now=new Date();
  const dateStr=now.toLocaleDateString()+' '+now.toLocaleTimeString();
  history.unshift({type,meal,date:dateStr});
  if(history.length>10) history.pop();
  saveDataToStorage();
  updateHistoryDisplay();
}

function updateHistoryDisplay(){
  const historyList=document.getElementById('historyList');
  historyList.innerHTML='';
  if(history.length===0){historyList.innerHTML='<li class="history-item">暂无记录</li>';return;}
  history.forEach(item=>{
    const typeText=item.type==='breakfast'?'早餐':item.type==='lunch'?'午餐':'晚餐';
    const li=document.createElement('li');
    li.className='history-item';
    li.innerHTML=`<strong>${typeText}:</strong> ${item.meal} <br><small>${item.date}</small>`;
    historyList.appendChild(li);
  });
}

function createEditPanel(){
  editPanel.innerHTML='';
  ["breakfast","lunch","dinner"].forEach(type=>{
    const section=document.createElement('div');
    section.innerHTML=`<h3>${type==="breakfast"?"早餐":type==="lunch"?"午餐":"晚餐"}</h3>`;
    const ul=document.createElement('ul');
    ul.className='meal-list';
    ul.addEventListener('click',e=>{
      if(e.target.tagName==='BUTTON'){
        e.target.closest('li').remove();
      }
    });
    DATA[type].forEach(meal=>{
      const li=document.createElement('li');
      li.innerHTML=`<input type="text" value="${meal}"><button>删除</button>`;
      ul.appendChild(li);
    });
    const addBtn=document.createElement('button');
    addBtn.textContent='添加新菜品';
    addBtn.style.marginBottom='15px';
    addBtn.addEventListener('click',()=>{
      const li=document.createElement('li');
      li.innerHTML=`<input type="text" value=""><button>删除</button>`;
      ul.appendChild(li);
    });
    section.appendChild(ul);
    section.appendChild(addBtn);
    editPanel.appendChild(section);
  });
  const saveBtn=document.createElement('button');
  saveBtn.className='btn';
  saveBtn.textContent='保存菜品';
  saveBtn.addEventListener('click',()=>{
    ["breakfast","lunch","dinner"].forEach(type=>{
      const sectionInputs=[...editPanel.querySelectorAll('h3')].filter(h=>h.textContent===
        (type==='breakfast'?'早餐':type==='lunch'?'午餐':'晚餐'))
      .map(h=>[...h.nextElementSibling.querySelectorAll('li input')]);
      DATA[type]=sectionInputs.flat().map(i=>i.value.trim()).filter(s=>s);
    });
    saveDataToStorage();
    alert('已保存菜品');
    createEditPanel();
  });
  editPanel.appendChild(saveBtn);
}

document.querySelectorAll('.meal-buttons .btn').forEach(btn=>{
  btn.addEventListener('click',()=>randomPick(btn.dataset.type));
});

document.getElementById('reroll').addEventListener('click',()=>{
  if(lastType) randomPick(lastType);
  else alert('请先选择一餐');
});

document.getElementById('copy').addEventListener('click',()=>{
  if(lastResult){
    navigator.clipboard.writeText(lastResult);
    alert('已复制: '+lastResult);
  }
});

document.getElementById('historyBtn').addEventListener('click',()=>{
  historyPanel.style.display=historyPanel.style.display==='none'?'block':'none';
  updateHistoryDisplay();
});

document.getElementById('clearHistory').addEventListener('click',()=>{
  history=[];
  saveDataToStorage();
  updateHistoryDisplay();
});

document.getElementById('editBtn').addEventListener('click',()=>{
  editPanel.style.display=editPanel.style.display==='none'?'block':'block';
  createEditPanel();
});

document.querySelectorAll('.tab-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    if(btn.dataset.tab==='edit'){editPanel.style.display='block'; historyPanel.style.display='none';}
    else {editPanel.style.display='none'; historyPanel.style.display='block'; updateHistoryDisplay();}
  });
});

loadSavedData();
updateHistoryDisplay();
createEditPanel();
</script>
</body>
</html>
